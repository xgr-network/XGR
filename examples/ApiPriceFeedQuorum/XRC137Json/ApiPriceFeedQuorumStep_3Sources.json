{
  "apiCalls": [
    {
      "contentType": "json",
      "extractMap": {
        "FetchedCoinbase": {
          "default": 0,
          "type": "double",
          "value": "double(resp.data.amount)"
        },
        "OkCoinbase": {
          "default": false,
          "type": "bool",
          "value": "double(resp.data.amount) > 0.0"
        }
      },
      "headers": {
        "Accept": "application/json"
      },
      "method": "GET",
      "name": "coinbase_spot",
      "urlTemplate": "https://api.coinbase.com/v2/prices/BTC-USD/spot"
    },
    {
      "contentType": "json",
      "extractMap": {
        "FetchedBitstamp": {
          "default": 0,
          "type": "double",
          "value": "double(resp.last)"
        },
        "OkBitstamp": {
          "default": false,
          "type": "bool",
          "value": "double(resp.last) > 0.0"
        }
      },
      "headers": {
        "Accept": "application/json"
      },
      "method": "GET",
      "name": "bitstamp_ticker",
      "urlTemplate": "https://www.bitstamp.net/api/v2/ticker/btcusd"
    },
    {
      "contentType": "json",
      "extractMap": {
        "FetchedGecko": {
          "default": 0,
          "type": "double",
          "value": "double(resp.bitcoin.usd)"
        },
        "OkGecko": {
          "default": false,
          "type": "bool",
          "value": "double(resp.bitcoin.usd) > 0.0"
        }
      },
      "headers": {
        "Accept": "application/json"
      },
      "method": "GET",
      "name": "coingecko_simple_price",
      "urlTemplate": "https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd"
    }
  ],
  "onInvalid": {
    "payload": {
      "CoinbasePrice": "[FetchedCoinbase]",
      "BitstampPrice": "[FetchedBitstamp]",
      "GeckoPrice": "[FetchedGecko]",

      "Pair": "[Base]-[Quote]",
      "Price": "[PrevPrice]",
      "DeltaPct": 0.0,

      "Ok": false,
      "Error": "Quorum failed or delta guard triggered",
      "Source": "quorum_3api",

      "Seq": "int64([Seq]) + 1"
    },
    "waitSec": 3600
  },
  "onValid": {
    "payload": {
      "CoinbasePrice": "[FetchedCoinbase]",
      "BitstampPrice": "[FetchedBitstamp]",
      "GeckoPrice": "[FetchedGecko]",

      "Pair": "[Base]-[Quote]",

      "Price": "consensus([[FetchedCoinbase],[FetchedBitstamp],[FetchedGecko]], \"rel\", \"ball\", \"median\", [QuorumTolPct], int64([K]))",
      "DeltaPct": "([PrevPrice] == 0.0) ? 0.0 : safeDiv(abs(consensus([[FetchedCoinbase],[FetchedBitstamp],[FetchedGecko]], \"rel\", \"ball\", \"median\", [QuorumTolPct], int64([K])) - [PrevPrice]), abs([PrevPrice]), 0.0)",

      "PrevPrice": "consensus([[FetchedCoinbase],[FetchedBitstamp],[FetchedGecko]], \"rel\", \"ball\", \"median\", [QuorumTolPct], int64([K]))",

      "Ok": true,
      "Error": "",
      "Source": "quorum_3api",

      "Seq": "int64([Seq]) + 1"
    },
    "waitSec": 3600
  },
  "payload": {
    "Base": {
      "default": "BTC",
      "type": "string"
    },
    "Quote": {
      "default": "USD",
      "type": "string"
    },

    "Pair": {
      "default": "BTC-USD",
      "type": "string"
    },

    "K": {
      "default": 2,
      "type": "int64"
    },
    "QuorumTolPct": {
      "default": 0.01,
      "type": "double"
    },
    "MaxDeltaPct": {
      "default": 0.2,
      "type": "double"
    },

    "PrevPrice": {
      "default": 0,
      "type": "double"
    },
    "Price": {
      "default": 0,
      "type": "double"
    },
    "DeltaPct": {
      "default": 0,
      "type": "double"
    },

    "CoinbasePrice": {
      "default": 0,
      "type": "double"
    },
    "BitstampPrice": {
      "default": 0,
      "type": "double"
    },
    "GeckoPrice": {
      "default": 0,
      "type": "double"
    },

    "Ok": {
      "default": false,
      "type": "bool"
    },
    "Error": {
      "default": "",
      "type": "string"
    },
    "Source": {
      "default": "quorum_3api",
      "type": "string"
    },
    "Seq": {
      "default": 0,
      "type": "int64"
    }
  },
  "rules": [
    "quorum([[FetchedCoinbase],[FetchedBitstamp],[FetchedGecko]], \"rel\", \"ball\", [QuorumTolPct], int64([K]))",
    "consensus([[FetchedCoinbase],[FetchedBitstamp],[FetchedGecko]], \"rel\", \"ball\", \"median\", [QuorumTolPct], int64([K])) > 0.0",
    "([PrevPrice] == 0.0) || (safeDiv(abs(consensus([[FetchedCoinbase],[FetchedBitstamp],[FetchedGecko]], \"rel\", \"ball\", \"median\", [QuorumTolPct], int64([K])) - [PrevPrice]), abs([PrevPrice]), 0.0) <= [MaxDeltaPct])"
  ]
}
